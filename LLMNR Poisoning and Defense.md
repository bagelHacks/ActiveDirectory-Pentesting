# LLMNR Poisoning and Defense

## LMNR Rundown 
LLMNR stands for link local multicast name resolution. This function is configured by default on Windows systems and is a common technique used to laterally move in a network. 

When DNS fails (or a computer requests a domain that does not exist), a LLMNR broadcast is sent to every node in the network. It basically say's "Does anybody know where I can get the IP of this system?". T

LLMNR poisoning is when a malicious actor is able to get on the network and start listening for these LLMNR broadcasts. After receiving this LLMNR request, the malicious actor can say "I have the IP of the system you are looking for". When this happens, the requesting system will send it's NTLM hash to the malicious listening server. The malicious actor can then crack the NTLM hash, or redirect it. 

## LLMNR Poisoning in Action

In this lab, there is a Domain Controller, multiple windows 10 workstations, and a Kali box representing the malicious system. 

### From the Kali box, start LLMNR listener with Responder 

responder -I eth0 -rdwv
- I = Network Interface
- r = Allow answers for netbois short queries
- d = Allow netbois domain queries
- v = verbose 

![[Pasted image 20210908094003.png]]

This will listen for LLMNR requests and display them 


### From one of the windows 10 workstations, simulate a failed DNS request by opening a network share that does not exist. When this DNS fails, a LLMNR broadcast will be sent. 

![[Pasted image 20210908094308.png]]

Immediately, this error displays

![[Pasted image 20210908094340.png]]

From the attack machine, we received the LLMNR request containing the user's (dschrute) NTLM hash.

![[Pasted image 20210908094445.png]]

### Crack the hash with hashcat

This hash was able to be cracked with hashcat

hashcat64.exe -m 5600 hash.txt rockyou.txt -O

![[Pasted image 20210908100359.png]]

## Defense 

I took this from Heath Adams Practical Ethical Hacking video course.

![[Pasted image 20210908101944.png]]

