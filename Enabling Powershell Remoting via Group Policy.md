# Enabling Powershell Remoting via Group Policy

Powershell remoting is a windows feature that allows specified Administrators to manage remote systems. This is also a common lateral movement technique. After learning about this technique, I wanted to do some sysad and configure it myself. 

In my testing environment, I hopped to the Domain Controller and opened up Group Policy Management. This is where GPO's are configured which are policies that can be applied to object's or OU's which are groups of objects. I will create a GPO that will be applied to all computers in the domain. This GPO will enable powershell remoting on those systems.

Right click Domain and select "Create GPO..."

![image](https://user-images.githubusercontent.com/90155329/132265276-57a2c3a8-29d0-4a5f-976d-a89e600c8f40.png)


Name the GPO 

![image](https://user-images.githubusercontent.com/90155329/132265316-cf7b1427-f405-49d1-a088-46b606c7404f.png)


Navigate to Computer Configuration > Administrative Templates > Windows Components > Windows Remote Management (WinRM) > WinRMService

![image](https://user-images.githubusercontent.com/90155329/132265332-1d544b0c-f94a-4ae7-ad51-59bf390a6bbb.png)

Enable to following options

![image](https://user-images.githubusercontent.com/90155329/132265350-94dd9b2f-f242-4a10-927c-86816b5de4ee.png)

![image](https://user-images.githubusercontent.com/90155329/132265358-a92da542-9bed-4d3a-8c58-a2dccc91b768.png)


The description reads "To allow WinRM service to receive requests over the network, configure the Windows Firewall policy setting with exceptions for Port 5985 (default port for HTTP).
" 

This means, part of this GPO will also require opening Windows Remote Management to the local firewall policy.

Navigate to Computer Configuration > Policies > Windows Settings > Windows Defender Firewall > Inbound Rules

![image](https://user-images.githubusercontent.com/90155329/132265382-6ed3f783-a014-4c91-8b31-15b6cff77895.png)

Create a new rule

![image](https://user-images.githubusercontent.com/90155329/132265402-6856a417-cb76-4af7-aa2e-26e0eb8ba55a.png)

Next, apply the GPO to the Domain Computer's group

![image](https://user-images.githubusercontent.com/90155329/132265417-2e3179e9-70fd-4d14-9ad7-a3619c4f8131.png)

Now any member of the Domain Admins group can use powershell remoting to manage systems remotely. 

jhalpert is in the Domain Admins group and can execute commands on Pam-computer

![image](https://user-images.githubusercontent.com/90155329/132265457-3fbf9b92-347f-4195-b488-d6d90f9944c1.png)

From Pam's Computer, I looked at the security event logs which resulted in a brief 4624 and 4625

![image](https://user-images.githubusercontent.com/90155329/132265465-c804c157-f4f9-4e11-bae9-0448e8b92717.png)

![image](https://user-images.githubusercontent.com/90155329/132265471-60e9a729-6bc4-4591-9a45-1911faf22683.png)

In an assume breach scenario, if jhalpert powershell remotes into a system that a threat actor has compromised, they can potentially have their credential dumped (Depending on the adversaries permissions.)
