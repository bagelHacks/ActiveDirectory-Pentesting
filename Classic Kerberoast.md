# Classic Kerberoast

This is a technique that abuses the way Kerberos works. 

## Kerberos Rundown

1. User requests a TGT by sending a timestamp encrypted with their credentials to the DC (KDC/Key Distribution Center)
2. KDC validates the authentication, and replies with a TGT.
3. When the user needs access to a service, they send the TGT to the TGS (Ticket Granting Service) server. 
4. The TGS server receives the TGT ticket and replies with a TGS ticket for the service the user is requesting.
5. The user sends that TGS ticket to the application for services.

## The weakness

In step 4, the TGS ticket that the user receives is encrypted with the hash of the service account running the service. This means, any valid user can take the TGS ticket and attempt to crack the hash offline.

## Kerberoast in Action

SPN or Service Principal Name, is a property that gets added to user objects when they are in charge of a service.

PowerView can be used to see all SPN accounts.

Get-NetUser -SPN | select cn

![image](https://user-images.githubusercontent.com/90155329/132372430-574fd86e-564f-4a53-ae45-6d502079ccdc.png)

The "SQL Service" account looks interesting. 

The Request-SPN cmdlet allows me to request the TGS ticket for the SQLService

Request-SPN

![image](https://user-images.githubusercontent.com/90155329/132372456-84c5d843-5feb-455d-a76e-14d8fb1220f6.png)

I used Rubeus.exe to pull the sqlhash

.\Rubeus.exe kerberoast /outfile c:\ad\tools\working\kerberoast.txt

![image](https://user-images.githubusercontent.com/90155329/132372488-bcc8041c-c4ad-4650-b3b5-fa0e8839be61.png)

![image](https://user-images.githubusercontent.com/90155329/132372508-34ffb114-5af6-4ee9-a786-294caf882bf1.png)

This hash can then be cracked with hashcat

hashcat64.exe -m 13100 hash.txt rockyou.txt -O

![image](https://user-images.githubusercontent.com/90155329/132372549-34fdf38f-9382-44f0-a217-116d1262ba5e.png)

